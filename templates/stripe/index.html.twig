{% extends 'base.html.twig' %}

{% block title %}Paiement Réussi{% endblock %}

{% block body %}
<div class="container">
    <div class="row justify-content-center mt-5">
        <div class="col-md-8 text-center">
            <h1 class="display-4 text-success">Merci pour votre achat !</h1>
            <p class="lead">Votre paiement a été traité avec succès.</p>
            <p>Une confirmation de votre commande a été envoyée à votre adresse e-mail.</p>

            <div class="alert alert-success mt-4" role="alert">
                <strong>Transaction ID :</strong> 
                {# {{ transaction_id }} #}
                 <br>
                <strong>Montant total Hors TVA:</strong>
                 {{ total | number_format(2, ',', ' ') }} € 
                 <br>
                <strong>Date de la transaction :</strong>
                 {{ "now"|date("m/d/Y") }}

            </div>

            

            <a href="{{ path('app_home') }}" class="btn btn-primary mt-3">Retour à l'accueil</a>
            <a href="#" class="btn btn-secondary mt-3">Voir mes commandes</a>
        </div>
    </div>
</div>


  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function(){
           const citySelector =  $('#order_city');
           const cityValue = citySelector.val();
           const url = `https://127.0.0.1:8000/city/${cityValue}/shipping/cost`;


        function ajaxRequest(url){
            $.ajax({
            url:url,
            type:'GET',
            success:function (response){

            const newResponse = JSON.parse(response)
            if(parseInt(newResponse.status) === 200){
                $('#shippingCost').text(newResponse.content)

                // conversion des montants en entier 
                const cardPrice = parseInt($("#card-price").text());
                const shippingCost = parseInt($("#shippingCost").text());
            
                //Montant total à payer

               $('.total-price').text(cardPrice+shippingCost);

            }
                
            },
            error:function (xhr, status, error){

            }
          })
        }
        ajaxRequest(url);

            citySelector.on('change', function (){
                const urlUpdate = `https://127.0.0.1:8000/city/${$(this).val()}/shipping/cost`;
               ajaxRequest(urlUpdate);
            })
        })
    </script>
{% endblock %}
